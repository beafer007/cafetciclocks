<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta http-equiv="refresh" content="21600">
  <title>City Clocks (4-up)</title>

  <style>
    :root{
      --bg0:#070a0f;
      --bg1:#0b1526;

      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.76);

      --pad: clamp(14px, 2vw, 28px);
      --radius: 22px;

      --city: clamp(18px, 2.2vw, 36px);
      --meta: clamp(14px, 1.6vw, 24px);

      /* digit sizing */
      --d-h: clamp(66px, 6.4vw, 120px);
      --d-w: calc(var(--d-h) * 0.72);
      --gap: clamp(8px, 1vw, 14px);
      --colon-w: clamp(14px, 1.6vw, 26px);
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; margin:0; }

    body{
      background:
        radial-gradient(900px 600px at 15% 15%, rgba(120,170,255,0.10), transparent 55%),
        radial-gradient(900px 600px at 85% 85%, rgba(255,120,210,0.08), transparent 55%),
        linear-gradient(160deg, var(--bg0), var(--bg1));
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow:hidden;
    }

    body::after{
      content:"";
      position:absolute; inset:0;
      pointer-events:none;
      background:
        radial-gradient(1200px 800px at 50% 40%, rgba(0,0,0,0.00), rgba(0,0,0,0.30)),
        repeating-linear-gradient(0deg, rgba(255,255,255,0.012), rgba(255,255,255,0.012) 1px, transparent 1px, transparent 3px);
      opacity: 0.30;
    }

    .wrap{
      position:relative;
      height:100%;
      display:flex;
      flex-direction:column;
      padding:var(--pad);
    }

    /* 4-up grid */
    .grid{
      flex:1;
      display:grid;
      gap: var(--pad);
      grid-template-columns: repeat(2, minmax(0, 1fr));
      grid-template-rows: repeat(2, minmax(0, 1fr));
      position: relative;
      z-index: 1;
    }

    /* CARD */
    .card{
      position:relative;
      border-radius: var(--radius);
      padding: calc(var(--pad) * 0.95);
      display:flex;
      flex-direction:column;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: 0 12px 30px rgba(0,0,0,0.38);

      background:
        radial-gradient(900px 320px at 20% 0%, rgba(var(--accent),0.22), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.04));
    }

    .card::after{
      content:"";
      position:absolute; inset:0;
      border-radius: var(--radius);
      background: radial-gradient(600px 220px at 30% 0%, rgba(255,255,255,0.10), transparent 60%);
      pointer-events:none;
      opacity: 0.9;
      z-index: 1;
    }

    .silhouette{
      position:absolute;
      right: 4%;
      bottom: -10%;
      width: 92%;
      height: 62%;
      opacity: 0.28;
      z-index: 0;
      pointer-events:none;
    }
    .silhouette svg{ width:100%; height:100%; display:block; }

    .shade{
      position:absolute;
      left:0; right:0; bottom:0;
      height: 55%;
      background: linear-gradient(to top,
        rgba(0,0,0,0.45),
        rgba(0,0,0,0.18),
        rgba(0,0,0,0.0)
      );
      z-index: 1;
      pointer-events:none;
    }

    .top, .mid{ position:relative; z-index: 2; }

    .top{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .topRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .topMeta{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      flex-wrap: wrap;
    }

    .city{
      font-size: var(--city);
      font-weight: 900;
      letter-spacing: 0.4px;
      display:flex;
      align-items:center;
      gap:12px;
      text-shadow: 0 10px 24px rgba(0,0,0,0.45);
      line-height:1.15;
    }
    .city span:last-child{ color: #ffd84a; }

    .badge{
      font-size: clamp(26px, 2.6vw, 42px);
      line-height:1;
      text-shadow: 0 10px 18px rgba(0,0,0,0.45);
    }

    .pill{
      border: 1px solid rgba(255,255,255,0.12);
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,0.22);
      white-space: nowrap;
      display:inline-flex;
      align-items:center;
      gap:10px;
      color: var(--muted);
      font-size: var(--meta);
      font-variant-numeric: tabular-nums;
      font-weight: 900;
    }

    .sunmoon{
      width: 22px; height: 22px;
      display:inline-grid;
      place-items:center;
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
    }

    .wxTop{
      font-size: clamp(16px, 1.4vw, 22px);
      padding: 10px 14px;
      gap: 10px;
    }
    .datePill{
      padding: 10px 14px;
      font-size: clamp(14px, 1.2vw, 20px);
    }
    .wxIcon{ font-size: 1.25em; }
    .wxTemp{ font-weight: 950; color: rgba(255,255,255,0.94); }
    .wxNote{ color: rgba(255,255,255,0.78); font-weight: 850; }

    /* CLOCK centered */
    .mid{
      flex: 1;
      display:flex;
      flex-direction:column;
      justify-content:center;
      margin-top: 8px;
      padding-bottom: 2vh;
    }

    .row{
      display:flex;
      align-items:flex-end;
      gap: var(--gap);
      flex-wrap: nowrap;
    }

    .ampm{
      font-size: clamp(18px, 1.8vw, 26px);
      font-weight: 900;
      letter-spacing: 2px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.18);
      color: rgba(255,255,255,0.86);
      margin-left: 2px;
      margin-bottom: 8px;
      text-shadow: 0 8px 16px rgba(0,0,0,0.45);
    }

    .colon{
      width: var(--colon-w);
      text-align:center;
      font-weight: 900;
      font-size: calc(var(--d-h) * 0.62);
      line-height:1;
      opacity: 0.92;
      text-shadow: 0 16px 26px rgba(0,0,0,0.55);
      transform: translateY(-8px);
    }
    .colon.blink{ animation: blink 1s steps(1,end) infinite; }
    @keyframes blink{ 50%{ opacity:0.35; } }

    .digitBox{
      width: var(--d-w);
      height: var(--d-h);
      border-radius: 14px;
      overflow:hidden;
      position:relative;
      background: rgba(0,0,0,0.72);
      border: 1px solid rgba(255,255,255,0.14);
      box-shadow: 0 12px 22px rgba(0,0,0,0.45);
    }
    .digitBox::after{
      content:"";
      position:absolute; left:-2px; right:-2px;
      top:50%;
      height:3px;
      background: rgba(0,0,0,0.78);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.10),
        inset 0 -1px 0 rgba(0,0,0,0.50);
      z-index:3;
    }
    .stack{
      position:absolute;
      left:0; top:0;
      width:100%;
      will-change: transform;
      transform: translate3d(0,0,0);
      transition: transform 220ms cubic-bezier(.2,.9,.2,1);
    }
    .cell{
      height: var(--d-h);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 950;
      font-variant-numeric: tabular-nums;
      letter-spacing: 1px;
      font-size: calc(var(--d-h) * 0.72);
      line-height:1;
      -webkit-font-smoothing: antialiased;
      color: rgba(255,255,255,0.92);
      text-shadow: 0 16px 28px rgba(0,0,0,0.60);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.38));
    }

    .time24{
      margin-top: 14px;
      color: #ffd84a;
      font-size: clamp(24px, 2.4vw, 44px);
      font-weight: 950;
      letter-spacing: 0.8px;
      font-variant-numeric: tabular-nums;
      text-shadow: 0 14px 26px rgba(0,0,0,0.55);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <main class="grid" id="grid"></main>
  </div>

  <script>
    const WEATHER_REFRESH_MS = 15 * 60 * 1000;

    // ‚úÖ No rotation. Show all 4.
    const CLOCKS = [
      { label: "Miami",  tz: "America/New_York", flag:"üá∫üá∏", accent:"255,120,170", lat:25.7617, lon:-80.1918, silhouette:"miami" },
      { label: "London", tz: "Europe/London",    flag:"üá¨üáß", accent:"170,150,255", lat:51.5072, lon:-0.1276,  silhouette:"london" },
      { label: "Dubai",  tz: "Asia/Dubai",       flag:"üá¶üá™", accent:"255,180,80",  lat:25.2048, lon:55.2708,  silhouette:"dubai" },
      { label: "Manila", tz: "Asia/Manila",      flag:"üáµüá≠", accent:"120,255,230", lat:14.5995, lon:120.9842, silhouette:"manila" },
    ];

    const grid = document.getElementById("grid");
    const digitState = new Map(); // key tz|pos -> current digit
    const cardCache = new Map();  // key tz|label -> cached dom refs

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, s => ({
        "&":"&amp;", "<":"&lt;", ">":"&gt;", '"':"&quot;", "'":"&#039;"
      }[s]));
    }

    const SILHOUETTES = {
      london: `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 600">
          <g fill="white" opacity="0.60">
            <rect x="0" y="520" width="1200" height="80"/>
            <rect x="820" y="180" width="90" height="340" rx="14"/>
            <rect x="808" y="150" width="114" height="40" rx="14"/>
            <rect x="835" y="110" width="60" height="50" rx="12"/>
            <polygon points="865,70 910,110 820,110"/>
            <circle cx="865" cy="260" r="34" fill="none" stroke="white" stroke-width="14" opacity="0.60"/>
            <rect x="260" y="360" width="120" height="160" rx="14"/>
            <rect x="400" y="330" width="140" height="190" rx="14"/>
            <rect x="560" y="390" width="160" height="130" rx="14"/>
          </g>
        </svg>
      `,
      dubai: `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 600">
          <g fill="white" opacity="0.60">
            <rect x="0" y="520" width="1200" height="80"/>
            <polygon points="820,520 900,520 880,180 870,120 860,80 850,120 840,180" />
            <rect x="858" y="40" width="6" height="60"/>
            <rect x="640" y="360" width="90" height="160" rx="12"/>
            <rect x="740" y="310" width="70" height="210" rx="12"/>
            <rect x="930" y="350" width="120" height="170" rx="14"/>
          </g>
        </svg>
      `,
      miami: `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 600">
          <g fill="white" opacity="0.60">
            <rect x="0" y="520" width="1200" height="80"/>
            <rect x="940" y="240" width="20" height="280" rx="10"/>
            <path d="M950 240 C880 220, 850 180, 870 150 C900 160, 930 190, 970 210 Z" />
            <path d="M950 240 C1020 220, 1050 180, 1030 150 C1000 160, 970 190, 930 210 Z" />
            <path d="M950 260 C900 270, 860 250, 840 220 C880 215, 910 235, 950 240 Z" />
            <path d="M950 260 C1000 270, 1040 250, 1060 220 C1020 215, 990 235, 950 240 Z" />
            <rect x="640" y="360" width="140" height="160" rx="20"/>
            <rect x="800" y="330" width="120" height="190" rx="20"/>
          </g>
        </svg>
      `,
      manila: `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 600">
          <g fill="white" opacity="0.60">
            <rect x="0" y="520" width="1200" height="80"/>
            <rect x="840" y="340" width="120" height="180" rx="14"/>
            <rect x="700" y="380" width="120" height="140" rx="14"/>
            <rect x="620" y="330" width="70" height="190" rx="14"/>
            <rect x="520" y="420" width="40" height="100" rx="10"/>
            <polygon points="540,320 580,420 500,420" />
          </g>
        </svg>
      `
    };

    function wxFromCode(code){
      const map = {
        0:["‚òÄÔ∏è","Clear"],1:["üå§Ô∏è","Mostly clear"],2:["‚õÖ","Partly cloudy"],3:["‚òÅÔ∏è","Overcast"],
        45:["üå´Ô∏è","Fog"],48:["üå´Ô∏è","Rime fog"],
        51:["üå¶Ô∏è","Drizzle"],53:["üå¶Ô∏è","Drizzle"],55:["üå¶Ô∏è","Drizzle"],
        56:["üåßÔ∏è","Freezing drizzle"],57:["üåßÔ∏è","Freezing drizzle"],
        61:["üåßÔ∏è","Rain"],63:["üåßÔ∏è","Rain"],65:["üåßÔ∏è","Heavy rain"],
        66:["üåßÔ∏è","Freezing rain"],67:["üåßÔ∏è","Freezing rain"],
        71:["üå®Ô∏è","Snow"],73:["üå®Ô∏è","Snow"],75:["üå®Ô∏è","Heavy snow"],77:["üå®Ô∏è","Snow grains"],
        80:["üå¶Ô∏è","Showers"],81:["üå¶Ô∏è","Showers"],82:["üåßÔ∏è","Heavy showers"],
        85:["üå®Ô∏è","Snow showers"],86:["üå®Ô∏è","Snow showers"],
        95:["‚õàÔ∏è","Thunderstorm"],96:["‚õàÔ∏è","Thunderstorm"],99:["‚õàÔ∏è","Thunderstorm"]
      };
      return map[code] || ["üå°Ô∏è","Weather"];
    }

    function time12Digits(tz){
      const parts = new Intl.DateTimeFormat("en-US", {
        timeZone: tz, hour: "2-digit", minute: "2-digit", second: "2-digit", hour12: true
      }).formatToParts(new Date());
      const h = parts.find(p => p.type === "hour")?.value ?? "12";
      const m = parts.find(p => p.type === "minute")?.value ?? "00";
      const s = parts.find(p => p.type === "second")?.value ?? "00";
      return `${h}${m}${s}`;
    }

    function fmtTime24(tz){
      return new Intl.DateTimeFormat(undefined, {
        timeZone: tz, hour: "2-digit", minute: "2-digit", hour12: false
      }).format(new Date());
    }

    function fmtDate(tz){
      return new Intl.DateTimeFormat(undefined, {
        timeZone: tz, weekday:"short", month:"short", day:"2-digit"
      }).format(new Date());
    }

    function ampmOnly(tz){
      const parts = new Intl.DateTimeFormat("en-US", {
        timeZone: tz, hour:"numeric", hour12:true
      }).formatToParts(new Date());
      return (parts.find(p=>p.type==="dayPeriod")?.value || "").toUpperCase();
    }

    function tzShortName(tz){
      const parts = new Intl.DateTimeFormat(undefined, {
        timeZone: tz, timeZoneName:"short"
      }).formatToParts(new Date());
      return parts.find(p=>p.type==="timeZoneName")?.value || tz;
    }

    function tzHour(tz){
      const parts = new Intl.DateTimeFormat("en-US", {
        timeZone: tz, hour:"2-digit", hour12:false
      }).formatToParts(new Date());
      return Number(parts.find(p=>p.type==="hour")?.value ?? "0");
    }

    function sunOrMoonEmoji(hour){
      return (hour >= 6 && hour < 18) ? "‚òÄÔ∏è" : "üåô";
    }

    function digitTemplate(tz, pos){
      const key = `${tz}|${pos}`;
      digitState.set(key, 0);
      const cells = Array.from({length:10}, (_,i)=>`<div class="cell">${i}</div>`).join("");
      return `
        <div class="digitBox" data-tz="${escapeHtml(tz)}" data-pos="${pos}">
          <div class="stack" data-stack>${cells}</div>
        </div>
      `;
    }

    async function fetchWeather(lat, lon){
      const url =
        `https://api.open-meteo.com/v1/forecast` +
        `?latitude=${encodeURIComponent(lat)}` +
        `&longitude=${encodeURIComponent(lon)}` +
        `&current=temperature_2m,weather_code` +
        `&temperature_unit=fahrenheit` +
        `&timezone=auto`;
      const res = await fetch(url, { cache: "no-store" });
      if (!res.ok) throw new Error("Weather fetch failed");
      const data = await res.json();
      return { temp: data?.current?.temperature_2m, code: data?.current?.weather_code };
    }

    function setDigit(boxEl, newVal){
      const tz = boxEl.getAttribute("data-tz");
      const pos = boxEl.getAttribute("data-pos");
      const key = `${tz}|${pos}`;
      const oldVal = digitState.get(key);
      if (oldVal === newVal) return;

      const stack = boxEl.querySelector("[data-stack]");
      const h = boxEl.getBoundingClientRect().height;
      stack.style.transform = `translate3d(0, ${-newVal * h}px, 0)`;
      digitState.set(key, newVal);
    }

    function buildAll(){
      grid.innerHTML = "";
      digitState.clear();
      cardCache.clear();

      for (const c of CLOCKS){
        const tzEsc = escapeHtml(c.tz);
        const card = document.createElement("section");
        card.className = "card";
        card.style.setProperty("--accent", c.accent);

        const sil = document.createElement("div");
        sil.className = "silhouette";
        sil.innerHTML = SILHOUETTES[c.silhouette] || "";
        card.appendChild(sil);

        const shade = document.createElement("div");
        shade.className = "shade";
        card.appendChild(shade);

        card.innerHTML += `
          <div class="top">
            <div class="topRow">
              <div class="city">
                <span class="badge">${escapeHtml(c.flag || "üåê")}</span>
                <span>${escapeHtml(c.label)}</span>
              </div>

              <div class="pill" style="opacity:.95">
                <span class="sunmoon" data-sunmoon="${tzEsc}">‚è≥</span>
                <span data-tzname="${tzEsc}">---</span>
              </div>
            </div>

            <div class="topMeta">
              <div class="pill datePill" data-date="${tzEsc}">---</div>

              <div class="pill wxTop" data-wx>
                <span class="wxIcon">üå°Ô∏è</span>
                <span class="wxTemp">--</span>
                <span class="wxNote">Loading</span>
              </div>
            </div>
          </div>

          <div class="mid">
            <div class="row" aria-label="12 hour clock (slide)">
              ${digitTemplate(c.tz,0)}
              ${digitTemplate(c.tz,1)}
              <div class="colon blink">:</div>
              ${digitTemplate(c.tz,2)}
              ${digitTemplate(c.tz,3)}
              <div class="colon blink">:</div>
              ${digitTemplate(c.tz,4)}
              ${digitTemplate(c.tz,5)}
              <div class="ampm" data-ampm="${tzEsc}">--</div>
            </div>

            <div class="time24" data-tz24="${tzEsc}">--:--</div>
          </div>
        `;

        const cacheKey = `${c.tz}|${c.label}`;
        cardCache.set(cacheKey, {
          tz: c.tz,
          lat: c.lat,
          lon: c.lon,
          ampmEl: card.querySelector("[data-ampm]"),
          t24El: card.querySelector("[data-tz24]"),
          dateEl: card.querySelector("[data-date]"),
          tzEl: card.querySelector("[data-tzname]"),
          sunEl: card.querySelector("[data-sunmoon]"),
          wxEl: card.querySelector("[data-wx]"),
        });

        grid.appendChild(card);
      }
    }

    function tick(){
      document.querySelectorAll(".digitBox").forEach(box => {
        const tz = box.getAttribute("data-tz");
        const pos = Number(box.getAttribute("data-pos"));
        const digits = time12Digits(tz);
        const n = Number(digits[pos] || "0");
        setDigit(box, n);
      });

      for (const c of cardCache.values()){
        c.ampmEl.textContent = ampmOnly(c.tz);
        c.t24El.textContent = fmtTime24(c.tz);
        c.dateEl.textContent = fmtDate(c.tz);
        c.tzEl.textContent = tzShortName(c.tz);
        c.sunEl.textContent = sunOrMoonEmoji(tzHour(c.tz));
      }
    }

    async function refreshWeather(){
      const tasks = [];
      for (const c of cardCache.values()){
        tasks.push((async () => {
          try{
            const wx = await fetchWeather(c.lat, c.lon);
            const [icon, labelText] = wxFromCode(wx.code);
            const t = (typeof wx.temp === "number") ? Math.round(wx.temp) : null;
            c.wxEl.innerHTML = `
              <span class="wxIcon">${icon}</span>
              <span class="wxTemp">${t !== null ? `${t}¬∞F` : "--"}</span>
              <span class="wxNote">${escapeHtml(labelText)}</span>
            `;
          } catch {
            c.wxEl.innerHTML = `
              <span class="wxIcon">üå°Ô∏è</span>
              <span class="wxTemp">--</span>
              <span class="wxNote">Weather</span>
            `;
          }
        })());
      }
      await Promise.allSettled(tasks);
    }

    // Start
    buildAll();
    tick();
    setInterval(tick, 1000);

    refreshWeather();
    setInterval(refreshWeather, WEATHER_REFRESH_MS);

    window.addEventListener("resize", (() => {
      let t;
      return () => {
        clearTimeout(t);
        t = setTimeout(() => {
          buildAll();
          tick();
          refreshWeather();
        }, 200);
      };
    })());
  </script>
</body>
</html>
