<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Clocks 1</title>

  <style>
    :root{
      --bg0:#05070d;
      --bg1:#070b14;
      --glass: rgba(20, 26, 38, 0.58);
      --glass2: rgba(10, 14, 22, 0.35);
      --text: rgba(255,255,255,0.95);
      --muted: rgba(255,255,255,0.82);
      --muted2: rgba(255,255,255,0.72);

      --cardRadius: 26px;
      --pad: clamp(18px, 2vw, 30px);

      --city: clamp(42px, 4.2vw, 74px);
      --time: clamp(78px, 7.2vw, 132px);
      --ampm: clamp(54px, 5.2vw, 100px);

      --small: clamp(18px, 1.6vw, 26px);
      --mid: clamp(22px, 2.0vw, 30px);
      --date: clamp(26px, 2.2vw, 34px);

      --shadow: 0 20px 55px rgba(0,0,0,0.45);
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; margin:0; background:#000; }
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      overflow:hidden;
      background:
        radial-gradient(1100px 700px at 18% 20%, rgba(80,130,255,0.14), transparent 60%),
        radial-gradient(1100px 700px at 82% 78%, rgba(255,80,170,0.10), transparent 60%),
        linear-gradient(160deg, var(--bg0), var(--bg1));
    }

    .wrap{
      height:100%;
      padding: var(--pad);
    }

    .grid{
      height:100%;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: var(--pad);
    }

    .card{
      position:relative;
      border-radius: var(--cardRadius);
      overflow:hidden;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,0.10);
      background:
        linear-gradient(180deg, rgba(255,255,255,0.07), rgba(0,0,0,0.28));
    }

    /* Flag stripes */
    .flagBg{
      position:absolute; inset:0;
      filter: saturate(1.15) contrast(1.05);
      opacity: 0.98;
    }
    /* Soft shading so white stripes don‚Äôt nuke readability */
    .shade{
      position:absolute; inset:0;
      background:
        radial-gradient(1000px 900px at 50% 55%, rgba(0,0,0,0.22), rgba(0,0,0,0.40)),
        linear-gradient(180deg, rgba(0,0,0,0.28), rgba(0,0,0,0.30));
      pointer-events:none;
    }

    /* Glass panel ‚Äì FULL WIDTH inside card */
    .glass{
      position:absolute;
      left: 22px; right: 22px;
      top: 50%;
      transform: translateY(-50%);
      padding: 28px 28px;
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(255,255,255,0.15), rgba(255,255,255,0.08));
      box-shadow: 0 18px 50px rgba(0,0,0,0.45);
      border: 1px solid rgba(255,255,255,0.16);
      backdrop-filter: blur(10px);
    }
    .glass::before{
      content:"";
      position:absolute; inset:0;
      border-radius: 22px;
      background: radial-gradient(700px 220px at 30% 15%, rgba(255,255,255,0.14), transparent 60%);
      pointer-events:none;
      opacity: 0.9;
    }

    .topRow{
      position:absolute;
      left: 18px; right: 18px; top: 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      z-index: 3;
      pointer-events:none;
    }
    .cityTop{
      display:flex;
      align-items:center;
      gap: 14px;
      font-weight: 950;
      font-size: clamp(24px, 2.4vw, 38px);
      text-shadow: 0 12px 26px rgba(0,0,0,0.45);
    }
    .pill{
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.14);
      font-weight: 900;
      font-size: clamp(14px, 1.2vw, 18px);
      color: rgba(255,255,255,0.88);
      box-shadow: 0 10px 26px rgba(0,0,0,0.35);
    }

    .content{
      position:relative;
      z-index: 4;
      text-align:center;
    }

    .cityBig{
      font-size: var(--city);
      font-weight: 950;
      letter-spacing: 0.5px;
      text-shadow: 0 16px 36px rgba(0,0,0,0.55);
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 16px;
      line-height: 1.05;
      margin-bottom: 10px;
      white-space: nowrap;
    }

    .time12{
      display:flex;
      align-items:baseline;
      justify-content:center;
      gap: 10px;
      margin-top: 2px;
      margin-bottom: 10px;
      white-space: nowrap;
    }
    .hhmm{
      font-size: var(--time);
      font-weight: 980;
      letter-spacing: 1px;
      text-shadow: 0 18px 44px rgba(0,0,0,0.62);
    }
    .ampm{
      font-size: var(--ampm);
      font-weight: 980;
      letter-spacing: 1px;
      text-shadow: 0 18px 44px rgba(0,0,0,0.62);
    }
    .colonBlink{
      display:inline-block;
      width: 0.6ch;
      text-align:center;
      animation: blink 1s steps(1,end) infinite;
    }
    @keyframes blink{ 50%{ opacity:0.28; } }

    .t24{
      margin-top: 2px;
      font-size: var(--mid);
      font-weight: 900;
      color: rgba(255,255,255,0.86);
      letter-spacing: 1px;
    }

    .dateLine{
      margin-top: 8px;
      font-size: var(--date);
      font-weight: 950;
      color: rgba(255,255,255,0.94);
      text-shadow: 0 14px 28px rgba(0,0,0,0.55);
    }

    .wx{
      margin-top: 18px; /* moved down a bit */
      font-size: var(--mid);
      font-weight: 950;
      color: rgba(255,255,255,0.92);
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .wxIcon{
      width: 44px; height: 44px;
      border-radius: 12px;
      background: rgba(0,0,0,0.28);
      border: 1px solid rgba(255,255,255,0.14);
      display:grid;
      place-items:center;
      box-shadow: 0 12px 28px rgba(0,0,0,0.35);
      font-size: 22px;
    }
    .wxText{
      font-weight: 950;
      color: rgba(255,255,255,0.92);
    }
    .wxSub{
      font-weight: 900;
      color: rgba(255,255,255,0.86);
    }

    @media (max-width: 1100px){
      .grid{ grid-template-columns: 1fr; }
      .glass{ left: 18px; right: 18px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="grid" id="grid"></div>
  </div>

  <script>
    // ===== Config =====
    const WEATHER_REFRESH_MS = 10 * 60 * 1000;

    const CITIES = [
      {
        label: "Miami",
        tz: "America/New_York",
        flag: "üá∫üá∏",
        tzBadge: "EST",
        lat: 25.7617, lon: -80.1918,
        // brighter ‚Äúflag-ish‚Äù stripes
        stripes: ["#B31942", "#FFFFFF", "#0A3161"]
      },
      {
        label: "London",
        tz: "Europe/London",
        flag: "üá¨üáß",
        tzBadge: "GMT",
        lat: 51.5072, lon: -0.1276,
        stripes: ["#012169", "#FFFFFF", "#C8102E"]
      },
      {
        label: "Dubai",
        tz: "Asia/Dubai",
        flag: "üá¶üá™",
        tzBadge: "GMT+4",
        lat: 25.2048, lon: 55.2708,
        stripes: ["#00732F", "#FFFFFF", "#000000", "#CE1126"]
      }
    ];

    // ===== Helpers =====
    const grid = document.getElementById("grid");

    function flagGradient(colors){
      const cols = Array.isArray(colors) && colors.length ? colors : ["#111"];
      const n = cols.length;
      const stops = cols.map((c, i) => {
        const p0 = Math.round((i / n) * 100);
        const p1 = Math.round(((i + 1) / n) * 100);
        return `${c} ${p0}%, ${c} ${p1}%`;
      }).join(", ");
      return `linear-gradient(90deg, ${stops})`;
    }

    function fmtDateLong(tz){
      return new Intl.DateTimeFormat("en-US", {
        timeZone: tz,
        weekday: "long",
        month: "short",
        day: "2-digit"
      }).format(new Date());
    }

    function fmtTime24WithSeconds(tz){
      return new Intl.DateTimeFormat("en-GB", {
        timeZone: tz,
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
        hour12: false
      }).format(new Date());
    }

    function time12Parts(tz){
      const parts = new Intl.DateTimeFormat("en-US", {
        timeZone: tz,
        hour: "numeric",
        minute: "2-digit",
        hour12: true
      }).formatToParts(new Date());

      const hour = (parts.find(p=>p.type==="hour")?.value || "12");
      const minute = (parts.find(p=>p.type==="minute")?.value || "00");
      const dayPeriod = (parts.find(p=>p.type==="dayPeriod")?.value || "").toUpperCase();
      return { hour, minute, dayPeriod };
    }

    function cToF(c){ return (c * 9/5) + 32; }
    function fToC(f){ return (f - 32) * 5/9; }

    function round(n){ return Math.round(n); }

    function wxFromCode(code){
      const map = {
        0:["‚òÄÔ∏è","Clear"],
        1:["üå§Ô∏è","Mostly clear"],
        2:["‚õÖ","Partly cloudy"],
        3:["‚òÅÔ∏è","Overcast"],
        45:["üå´Ô∏è","Fog"],48:["üå´Ô∏è","Rime fog"],
        51:["üå¶Ô∏è","Drizzle"],53:["üå¶Ô∏è","Drizzle"],55:["üå¶Ô∏è","Drizzle"],
        56:["üåßÔ∏è","Freezing drizzle"],57:["üåßÔ∏è","Freezing drizzle"],
        61:["üåßÔ∏è","Rain"],63:["üåßÔ∏è","Rain"],65:["üåßÔ∏è","Heavy rain"],
        66:["üåßÔ∏è","Freezing rain"],67:["üåßÔ∏è","Freezing rain"],
        71:["üå®Ô∏è","Snow"],73:["üå®Ô∏è","Snow"],75:["üå®Ô∏è","Heavy snow"],77:["üå®Ô∏è","Snow grains"],
        80:["üå¶Ô∏è","Showers"],81:["üå¶Ô∏è","Showers"],82:["üåßÔ∏è","Heavy showers"],
        85:["üå®Ô∏è","Snow showers"],86:["üå®Ô∏è","Snow showers"],
        95:["‚õàÔ∏è","Thunderstorm"],96:["‚õàÔ∏è","Thunderstorm"],99:["‚õàÔ∏è","Thunderstorm"]
      };
      return map[code] || ["üå°Ô∏è","Weather"];
    }

    async function fetchWeather(lat, lon){
      // current + daily hi/lo for today/tomorrow
      const url =
        `https://api.open-meteo.com/v1/forecast` +
        `?latitude=${encodeURIComponent(lat)}` +
        `&longitude=${encodeURIComponent(lon)}` +
        `&current=temperature_2m,weather_code` +
        `&daily=temperature_2m_max,temperature_2m_min,weather_code` +
        `&temperature_unit=fahrenheit` +
        `&timezone=auto` +
        `&forecast_days=2`;

      const res = await fetch(url, { cache: "no-store" });
      if (!res.ok) throw new Error("Weather fetch failed");
      const data = await res.json();

      const curF = data?.current?.temperature_2m;
      const curCode = data?.current?.weather_code;

      const dMax = data?.daily?.temperature_2m_max || [];
      const dMin = data?.daily?.temperature_2m_min || [];
      const dCode = data?.daily?.weather_code || [];

      return {
        curF,
        curCode,
        tomHiF: dMax[1],
        tomLoF: dMin[1],
        tomCode: dCode[1]
      };
    }

    function buildCard(c){
      const card = document.createElement("section");
      card.className = "card";

      const flag = document.createElement("div");
      flag.className = "flagBg";
      flag.style.backgroundImage = flagGradient(c.stripes);

      const shade = document.createElement("div");
      shade.className = "shade";

      const top = document.createElement("div");
      top.className = "topRow";
      top.innerHTML = `
        <div class="cityTop"><span>${c.flag}</span><span>${c.label}</span></div>
        <div class="pill">${c.tzBadge}</div>
      `;

      const glass = document.createElement("div");
      glass.className = "glass";
      glass.innerHTML = `
        <div class="content">
          <div class="cityBig"><span>${c.flag}</span><span>${c.label}</span></div>

          <div class="time12">
            <div class="hhmm" data-hhmm></div>
            <div class="ampm" data-ampm></div>
          </div>

          <div class="t24" data-t24>--:--:--</div>
          <div class="dateLine" data-date>------</div>

          <div class="wx">
            <div class="wxIcon" data-wxicon>üå°Ô∏è</div>
            <div class="wxText" data-wxtext>--</div>
            <div class="wxSub" data-wxsub>Loading...</div>
          </div>
        </div>
      `;

      card.append(flag, shade, top, glass);

      // stash refs
      card._refs = {
        hhmm: glass.querySelector("[data-hhmm]"),
        ampm: glass.querySelector("[data-ampm]"),
        t24:  glass.querySelector("[data-t24]"),
        date: glass.querySelector("[data-date]"),
        wxIcon: glass.querySelector("[data-wxicon]"),
        wxText: glass.querySelector("[data-wxtext]"),
        wxSub:  glass.querySelector("[data-wxsub]")
      };

      return card;
    }

    function renderTime(card, c){
      const { hour, minute, dayPeriod } = time12Parts(c.tz);

      // Big time: HH:MM with blinking colon, no seconds
      card._refs.hhmm.innerHTML = `
        ${hour}<span class="colonBlink">:</span>${minute}
      `;
      card._refs.ampm.textContent = dayPeriod;

      // 24h line with seconds
      card._refs.t24.textContent = fmtTime24WithSeconds(c.tz);

      // Full weekday
      card._refs.date.textContent = fmtDateLong(c.tz);
    }

    async function renderWeather(card, c){
      try{
        const wx = await fetchWeather(c.lat, c.lon);

        const [icon, label] = wxFromCode(wx.curCode);
        card._refs.wxIcon.textContent = icon;

        const curF = (typeof wx.curF === "number") ? round(wx.curF) : null;
        const curC = (curF !== null) ? round(fToC(curF)) : null;

        const hiF = (typeof wx.tomHiF === "number") ? round(wx.tomHiF) : null;
        const loF = (typeof wx.tomLoF === "number") ? round(wx.tomLoF) : null;
        const hiC = (hiF !== null) ? round(fToC(hiF)) : null;
        const loC = (loF !== null) ? round(fToC(loF)) : null;

        card._refs.wxText.textContent =
          (curF !== null && curC !== null) ? `${curF}¬∞F / ${curC}¬∞C` : `--`;

        card._refs.wxSub.textContent =
          ` ${label}  ‚Ä¢  Tomorrow ${hiF ?? "--"}/${loF ?? "--"}¬∞F (${hiC ?? "--"}/${loC ?? "--"}¬∞C)`;

      } catch (e){
        card._refs.wxIcon.textContent = "üå°Ô∏è";
        card._refs.wxText.textContent = "--";
        card._refs.wxSub.textContent = "Weather unavailable";
      }
    }

    // ===== Boot =====
    const cards = CITIES.map(c => {
      const card = buildCard(c);
      grid.appendChild(card);
      return { card, c };
    });

    function tick(){
      for (const x of cards) renderTime(x.card, x.c);
    }

    async function refreshWx(){
      await Promise.allSettled(cards.map(x => renderWeather(x.card, x.c)));
    }

    tick();
    setInterval(tick, 1000);

    refreshWx();
    setInterval(refreshWx, WEATHER_REFRESH_MS);
  </script>
</body>
</html>
